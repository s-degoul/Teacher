<?php
$title_view = 'Ce patient';
$style[] = 'patient_profile';
?>

<h1><?php echo strtoupper($patient['patient_surname']).' '.$patient['patient_firstname']; ?></h1>

<div class='patient_profile'>
	<h3>Données patient</h3>
	<div>
		<div class='patient_profile_side'>
			<h3>Identité</h3>
			<ul>
<?php
$sex_title = '';
if ($patient['patient_sex'] == 'm')
	$sex_title = 'garçon';
elseif ($patient['patient_sex'] == 'f')
	$sex_title = 'fille';
?>
				<li>Sexe : <?php echo $sex_title; ?></li>
				<li>Age : <?php echo $_SESSION['patient']['patient_age']; ?></li>
				<li>Date de naissance : <?php echo $patient['patient_date_birth']; ?></li>
			</ul>
		</div>
		<div class='patient_profile_side'>
			<h3>Données physiologiques</h3>
			<ul>
				<li>Taille : <?php echo $patient['patient_height']; ?> cm</li>
				<li>Poids : <?php echo $patient['patient_weight']; ?> kg</li>
				<li>Débit expiratoire de pointe (DEP) : <?php echo $patient['patient_peakflow']; ?> L/min</li>
				<li>DEP 80% : <?php echo 0.8 * $patient['patient_peakflow']; ?> L/min</li>
				<li>DEP 60% : <?php echo 0.6 * $patient['patient_peakflow']; ?> L/min</li>
			</ul>
		</div>
	</div>
</div>
<div class='patient_profile'>
	<h3>Diagnostic éducatif</h3>
	<div class='patient_profile_side'>
		<ul>
<?php
	if (isset ($educ_diag['id_educ_diag'])) {
		echo'			<li>Réalisé le  '.$educ_diag['educ_diag_date'].'</li>';
		echo'			<li><a href=\'.?module=&action=&id_educ_diag='.$educ_diag['id_educ_diag']
						.'\'>Le consulter</a></li>';
		echo'			<li>Conclusion : </li>';
	}
	else {
		echo '			<li>Non réalisé</li>';
		echo'			<li><a href=\'.?module=&action=\'>Le faire maintenant</a></li>';
	}
?>
		</ul>
	</div>
</div>

<div class='patient_profile'>
	<h3>Cycles d'éducation thérapeutique</h3>

	<div>
<?php
/*
	$cycle_TE = array (
			1 => array (
				'date_start' => '24/04/13',
				'date_end' => '06/06/13',
				'targets' => array (
						2 => '03/05/13',
						7 => '03/05/13',
						9 => '03/05/13',
						5 => '25/05/13'
						),
				'evaluation' => array (
						'id' => 1,
						'date_evaluation' => '06/06/13'
						)
				),
			2 => array (
				'date_start' => '08/06/13',
				'date_end' => '13/07/13',
				'targets' => array (
						2 => '08/06/13',
						8 => '16/06/13'
						),
				'evaluation' => array (
						'id' => 2,
						'date_evaluation' => '24/06/13'
						)
				),
			3 => array (
				'date_start' => '30/06/13',
				'date_end' => 'en cours',
				'targets' => array (
						3 => '30/06/13',
						9 => '',
						),
				'evaluation' => array (
						'id' => 0,
						'date_evaluation' => ''
						)
				)
			);
*/
echo '<pre>';
print_r ($list_cycle_educ);
echo '</pre>';

$nb_cycle = 0;

ksort ($list_cycle_educ);

foreach ($list_cycle_educ as $cycle_start_date => $feature_cycle) {

	$nb_cycle ++;
	ksort ($list_cycle_educ[$cycle_start_date]['targets']);

?>
	<div class='patient_profile_side'>
		<h3>n° <?php echo $nb_cycle; ?></h3>
		<p>Période</p>
			<ul>
				<li>date de début : <?php echo $cycle_start_date ?></li>
				<li>date de fin : <?php echo $feature_cycle['cycle_educ_eval_date'] ?></li>
			</ul>
		<p>Objectifs</p>
			<ul>
<?php
	foreach ($feature_cycle['targets'] as $num_target => $feature_target) {
		if ($feature_target['cycle_target_date'] != '')
			echo'				<li>Objectif '.$num_target.' : fait (le '.$feature_target['cycle_target_date'].')</li>'."\n";
		else
			echo'				<li>Objectif '.$num_target.' : non réalisé</li>'."\n";
	}
?>

			</ul>
		<p>Evaluation finale</p>
			<ul>
<?php
	if ($feature_cycle['cycle_educ_eval_date'] != '') {
		echo'				<li>réalisée le '.$feature_cycle['cycle_educ_eval_date'].'</li>'."\n";
		echo'				<li><a href=\'.?view=patient_evaluation\'>la consulter</a></li>'."\n";
	}
	else {
		echo'				<li>non réalisée</li>'."\n";
	}
?>
			</ul>
	</div>
<?php

	if ($nb_cycle % 2 == 0) {
		echo '	</div>'."\n".'	<div>';
	}
}
?>
	</div>
</div>
